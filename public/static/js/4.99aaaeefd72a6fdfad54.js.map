{"version":3,"sources":["webpack:///src/views/blog/Edit.vue","webpack:///./src/views/blog/Edit.vue?7fdc","webpack:///./src/views/blog/Edit.vue"],"names":["Edit","data","loading","form","id","title","description","content","rules","required","message","trigger","type","max","submitButton","disabled","toolBars","bold","italic","header","underline","strikethrough","mark","superscript","subscript","quote","ol","ul","link","imagelink","code","table","fullscreen","readmodel","htmlcode","help","undo","redo","trash","save","navigation","alignleft","aligncenter","alignright","subfield","preview","components","TokenDialog","TokenDialogue","computed","extends_default","Object","vuex_esm","mounted","_this","this","token","$router","go","$route","params","$http","get","then","response","article","body","console","log","methods","imageAdd","pos","$file","_this2","formData","FormData","append","utils","uploadImage","res","$refs","$img2Url","url","catch","err","onSubmit","_this3","publish","open","change","value","render","_this4","self","validate","valid","obj","_id","date","getDate","post","articleInformation","$message","push","goBack","blog_Edit","_vm","_h","$createElement","_c","_self","ref","attrs","model","label-width","label","prop","callback","$$v","$set","expression","_v","staticStyle","max-height","toolbars","on","imgAdd","click","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/4.99aaaeefd72a6fdfad54.js","sourcesContent":["<template>\n   <!-- Edit和Add大致一样，但是mounted时需要自动加载已经有的内容 -->\n   <div>\n      <el-card>\n         <el-form :model=\"form\" ref=\"form\" :rules=\"rules\" label-width=\"80px\">\n            <el-form-item label=\"标题\"  prop=\"title\">\n               <el-input v-model=\"form.title\" ></el-input>\n            </el-form-item>\n            <el-form-item label=\"描述\"  prop=\"description\">\n               <el-input v-model=\"form.description\" type=\"text-area\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"博客正文\"  prop=\"content\">\n               <mavon-editor @imgAdd=\"imageAdd\" @change=\"change\" style=\"max-height: 500px\" v-model=\"form.content\" :toolbars=\"toolBars\" ref=\"md\"></mavon-editor>\n            </el-form-item>\n            <el-form-item>\n               <el-button type=\"primary\" @click=\"onSubmit\" :loading=\"submitButton.loading\" :disabled=\"submitButton.disabled\">修改</el-button>\n               <el-button @click=\"goBack\">返回</el-button>\n            </el-form-item>\n         </el-form>\n      </el-card>\n      <token-dialog ref=\"tokenDialog\"></token-dialog>\n   </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport TokenDialog from '../../views/common/TokenDialogue'\nimport GistApi from '../../api/gist'\nimport utils from '../../utils/utils'\nexport default {\n   data () {\n      return {\n         loading: false, // 初始化时读取该blog的详细信息\n         form:{\n            id: '',\n            title: '',\n            data: '',\n            description: '',\n            content: ''\n         },\n         rules:{\n            title:[\n               {required: true, message: '请输入标题',trigger:'blur'},\n               {type: 'string', max:32, message:'标题长度不大于32字符',trigger:'change'}\n            ],\n            description:[\n               {required: true, message: '请输入博客描述', trigger:'blur'}\n            ],\n            content:[\n               {required: true, message: '请输入博客正文', trigger:'blur'}\n            ]\n         },\n         submitButton:{ // 提交按钮的加载中和禁用\n            loading: false,\n            disabled: false\n         },\n         toolBars: {\n            bold: true, // 粗体\n            italic: true, // 斜体\n            header: true, // 标题\n            underline: true, // 下划线\n            strikethrough: true, // 中划线\n            mark: true, // 标记\n            superscript: true, // 上角标\n            subscript: true, // 下角标\n            quote: true, // 引用\n            ol: true, // 有序列表\n            ul: true, // 无序列表\n            link: true, // 链接\n            imagelink: true, // 图片链接\n            code: true, // code\n            table: true, // 表格\n            fullscreen: true, // 全屏编辑\n            readmodel: true, // 沉浸式阅读\n            htmlcode: true, // 展示html源码\n            help: true, // 帮助\n            /* 1.3.5 */\n            undo: true, // 上一步\n            redo: true, // 下一步\n            trash: true, // 清空\n            save: true, // 保存（触发events中的save事件）\n            /* 1.4.2 */\n            navigation: true, // 导航目录\n            /* 2.1.8 */\n            alignleft: true, // 左对齐\n            aligncenter: true, // 居中\n            alignright: true, // 右对齐\n            /* 2.2.1 */\n            subfield: true, // 单双栏模式\n            preview: true, // 预览\n         }\n      };\n   },\n\n   components: {\n      TokenDialog\n   },\n\n   computed: {\n      ...mapGetters([\n         'token'\n      ])\n   },\n\n   mounted(){\n      if(!this.token) {\n         this.message({\n            message:'权限不足,请绑定token',\n            type: 'error' \n         })\n         this.$router.go(-1)\n         return\n      }\n      this.form.id = this.$route.params.id\n      /*\n      GistApi.single(this.$route.params.id).then((response)=>{\n         let result = response.data;\n         this.form.description = result.description\n         for(let key in result.files){\n            this.form.title = key\n            this.form.content = result.files[key]['content']\n            break\n         }\n      }).then(()=>{\n         this.loading = false;\n      })\n      */\n      this.$http.get('/api/articleDetail/'+this.$route.params.id).then(\n         response => {\n            let article = response.body;\n            console.log(\"article\",article);\n            this.form.id = this.$route.params.id;\n            this.form.title = article.title;\n            this.form.description = article.description;\n            this.form.content = article.content;\n         }\n      )\n\n   },\n\n   methods: {\n            // 以formatdata格式上传\n      imageAdd(pos, $file){\n         // this.$refs['md'].$img2Url(pos, file.miniurl)\n               //以formdata格式上传\n         console.log($file)\n         console.log(\"base_api\",process.env.API_ROOT)\n         let formData = new FormData();\n         formData.append(\"file\",$file);\n         utils.uploadImage(formData)\n         .then(res => {\n               // this.$refs.md.$img2Url 作用是把Markdown里上传成功的图片url替换为服务器返回的url\n            // this.$refs.md.$img2Url(pos, this.baseUrl + res.url);\n            this.$refs['md'].$img2Url(pos, process.env.API_ROOT + res.data.url);\n         })\n         .catch(err => {\n            console.log(err);\n         });\n      },\n      onSubmit(){\n         if(this.token){\n            this.publish()\n         }else{\n            this.$refs['tokenDialog'].open(()=>{\n               this.publish()\n            })\n         }\n      },\n      change(value,render){\n         this.form.content = render\n      },\n      publish(){\n         let self = this;\n         this.$refs['form'].validate((valid)=>{\n            if(valid){\n               this.submitButton.loading = true\n               this.submitButton.disabled = true\n               /*\n               GistApi.edit(this.form).then((response)=>{\n                  let result = response.data\n                  this.$message({\n                     message: '修改成功!',\n                     type:'success'\n                  })\n                  this.$router.push('/user/blog/details/'+result.id)\n               }).then(()=>{\n                  this.submitButton.loading = false;\n                  this.submitButton.disabled = false;\n               })\n               */\n              let obj = {};\n              obj._id = this.form.id;\n              obj.title = this.form.title;\n              obj.description = this.form.description;\n              obj.content = this.form.content;\n              obj.date = utils.getDate();\n              console.log(this.form)\n              self.$http.post('/api/admin/updateArticle',{\n                 articleInformation: obj\n              }).then(\n                 response =>{\n                  this.$message({\n                     message: '修改成功!',\n                     type:'success'\n                  })\n                  this.$router.push('/user/blog/details/'+obj._id)\n                  this.submitButton.loading = false\n                  this.submitButton.disabled = false\n                 }\n\n              )\n\n            }\n         })\n      },\n      goBack(){\n         this.$router.go(-1)\n      }\n   }\n}\n</script>\n<style lang='css' scoped>\n\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/blog/Edit.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-card',[_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.form,\"rules\":_vm.rules,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"标题\",\"prop\":\"title\"}},[_c('el-input',{model:{value:(_vm.form.title),callback:function ($$v) {_vm.$set(_vm.form, \"title\", $$v)},expression:\"form.title\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"描述\",\"prop\":\"description\"}},[_c('el-input',{attrs:{\"type\":\"text-area\"},model:{value:(_vm.form.description),callback:function ($$v) {_vm.$set(_vm.form, \"description\", $$v)},expression:\"form.description\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"博客正文\",\"prop\":\"content\"}},[_c('mavon-editor',{ref:\"md\",staticStyle:{\"max-height\":\"500px\"},attrs:{\"toolbars\":_vm.toolBars},on:{\"imgAdd\":_vm.imageAdd,\"change\":_vm.change},model:{value:(_vm.form.content),callback:function ($$v) {_vm.$set(_vm.form, \"content\", $$v)},expression:\"form.content\"}})],1),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\",\"loading\":_vm.submitButton.loading,\"disabled\":_vm.submitButton.disabled},on:{\"click\":_vm.onSubmit}},[_vm._v(\"修改\")]),_vm._v(\" \"),_c('el-button',{on:{\"click\":_vm.goBack}},[_vm._v(\"返回\")])],1)],1)],1),_vm._v(\" \"),_c('token-dialog',{ref:\"tokenDialog\"})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7f7364e4\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/blog/Edit.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7f7364e4\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Edit.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Edit.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Edit.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7f7364e4\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Edit.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7f7364e4\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/blog/Edit.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}